
# ã€æ¯æ—¥ä¸€é¢˜ã€‘(35é¢˜)ç®—æ³•é¢˜ï¼šä½ å¯¹å›¾è®ºäº†è§£å¤šå°‘ï¼Ÿ(äº”)

å…³æ³¨ã€Œæ¾å®å†™ä»£ç ã€ï¼Œç²¾é€‰å¥½æ–‡ï¼Œæ¯æ—¥ä¸€é¢˜

å‰ä¸¤æœŸçš„å›¾è®ºå·²ç»ä»‹ç»å®Œäº†ï¼Œä»Šå¤©æˆ‘ä»¬ä»‹ç»ç¬¬ä¸‰æœŸã€‚

ä»Šå¤©å¸¦æ¥çš„æ˜¯`Overstars`çš„å›¾è®ºæ€»ç»“ï¼ŒACMæ‰“æ¯”èµ›ï¼Œä»–çš„æ–¹å‘æ˜¯æ€ç»´æ•°è®ºå›¾è®ºã€‚ä¸‹æ–‡æ˜¯ä»–å’Œä»–é˜Ÿå‹å››å¹´åˆ·å›¾è®ºçš„æ€»ç»“ã€‚å…¶å®æœ¬èº«å°±æ˜¯ä¸ªç¬”è®°ï¼Œä»¥åæ–¹ä¾¿æ‰“æ¿å­çš„ã€‚

> ä½œè€…ï¼š Overstars
> https://shuangxunian.gitee.io/2020/08/24/graphTheory/

2020ï¼Œå®ã€Œé¼ ã€ä¸æ˜“

2021ï¼Œã€Œç‰›ã€è½¬ä¹¾å¤

é£åŠ²æ½®æ¶Œå½“æ‰¬å¸†ï¼Œä»»é‡é“è¿œé¡»å¥‹è¹„ï¼


***

## ä¸€ã€å‰è¨€

2020.12.23 ç«‹çš„ flagï¼Œæ¯æ—¥ä¸€é¢˜ï¼Œé¢˜ç›®ç±»å‹ä¸é™åˆ¶ï¼Œæ¶‰åŠåˆ°JavaScriptï¼ŒNodeï¼ŒVueï¼ŒReactï¼Œæµè§ˆå™¨ï¼Œhttpï¼Œç®—æ³•ç­‰é¢†åŸŸã€‚

æœ¬æ–‡æ˜¯ï¼šã€æ¯æ—¥ä¸€é¢˜ã€‘(35é¢˜)ç®—æ³•é¢˜ï¼šä½ å¯¹å›¾è®ºäº†è§£å¤šå°‘ï¼Ÿ(äº”)

![æ¯æ—¥ä¸€é¢˜](https://raw.githubusercontent.com/saucxs/full_stack_knowledge_list/master/daily-question/daily_question.png?raw=true)

å‰4æœŸï¼š

[ã€æ¯æ—¥ä¸€é¢˜ã€‘(34é¢˜)é¢è¯•å®˜:ä½ å¯¹å›¾è®ºäº†è§£å¤šå°‘ï¼Ÿ(å››)](https://mp.weixin.qq.com/s/EJ_72u5S7KD4950IEO_CQg)

[ã€æ¯æ—¥ä¸€é¢˜ã€‘(33é¢˜)é¢è¯•å®˜:ä½ å¯¹å›¾è®ºäº†è§£å¤šå°‘ï¼Ÿ(ä¸‰)](https://mp.weixin.qq.com/s/wRy1xAm4JzHCq1dRjMUuoA)

[ã€æ¯æ—¥ä¸€é¢˜ã€‘(32é¢˜)é¢è¯•å®˜:ä½ å¯¹å›¾è®ºäº†è§£å¤šå°‘ï¼Ÿ(äºŒ)](https://mp.weixin.qq.com/s/_aSMIEpBc2jvTFXxBaK7nQ)

[ã€æ¯æ—¥ä¸€é¢˜ã€‘(31é¢˜)é¢è¯•å®˜:ä½ å¯¹å›¾è®ºäº†è§£å¤šå°‘ï¼Ÿ(ä¸€)](https://mp.weixin.qq.com/s/E6dh8A9dVxxB9jaRGm3kbg)



## äºŒã€æ±‡æ€»
+ æ ‘é“¾å‰–åˆ†
	+ 1ã€é€šç”¨æ¨¡æ¿
	+ 2ã€P3384 æ ‘é“¾å‰–åˆ†
+ ç‚¹åˆ†æ²»
	+ 1ã€æ ‘çš„é‡å¿ƒ
	+ 2ã€æµç¨‹
	+ 3ã€ä¾‹é¢˜

## ä¸‰ã€æ ‘é“¾å‰–åˆ†

æ³¨æ„ä»¥ç‚¹ä»£è¾¹çš„æ€æƒ³

- åŠŸèƒ½
  1. æ›´æ–°/æŸ¥è¯¢æŸä¸ªèŠ‚ç‚¹å­æ ‘çš„æƒå€¼
  2. æ›´æ–°/æŸ¥è¯¢æ ‘ä¸Šä¸¤ä¸ªèŠ‚ç‚¹é—´æ‰€æœ‰ç‚¹çš„æƒå€¼
- æ€§è´¨
  1. å­æ ‘çš„æ—¶é—´æˆ³ä¸€å®šå…¨éƒ¨å°äºçˆ¶èŠ‚ç‚¹ï¼Œå¹¶ä¸”è¿ç»­ï¼ˆæ‰€ä»¥å¯ç”¨çº¿æ®µæ ‘ç»´æŠ¤ï¼‰
  2. ä»»ä½•ä¸€æ¡è·¯å¾„éƒ½æ˜¯ç”±é‡é“¾çš„ä¸€éƒ¨åˆ†ä¸é‡é“¾é—´çš„å¶å­èŠ‚ç‚¹æ„æˆ
  3. ä»»ä½•çˆ¶èŠ‚ç‚¹éƒ½ä¸€å®šåœ¨ä¸€æ¡é‡é“¾ä¸Šï¼ˆæ‰€ä»¥å¯ç”¨topçš„çˆ¶èŠ‚ç‚¹è·³é“¾ï¼‰
- ä¾‹é¢˜
  1. [P3384 æ ‘é“¾å‰–åˆ† ](https://www.luogu.org/problem/P3384)

### 1ã€é€šç”¨æ¨¡æ¿

```cpp
int n,tot=0,head[maxn];
ll val[maxn];//ç»™å®šçš„æ¯ä¸ªèŠ‚ç‚¹çš„æƒå€¼
struct edge
{//è¾¹æƒä¸€èˆ¬ä¸å¿…è®°å½•åˆ°è¿™é‡Œ
	int v,w,nex;
} e[maxn<<1];
inline void add(int u,int v,int w=0)
{
	e[++tot].v=v;
	e[tot].w=w;
	e[tot].nex=head[u];
	head[u]=tot;
}
//ä»¥ç‚¹ä»£è¾¹:ä»¥èŠ‚ç‚¹çš„æƒå€¼ä»£è¡¨è¯¥èŠ‚ç‚¹åˆ°çˆ¶èŠ‚ç‚¹è¾¹çš„æƒå€¼,ä¿®æ”¹ä¸æŸ¥è¯¢è·³è¿‡é“¾é¡¶ç‚¹å³å¯(æœ€ç»ˆçš„å‚æ•°æ”¹ä¸ºdfn[x]+1)
//ä½¿ç”¨å‰å…ˆåˆå§‹åŒ–,ç„¶ååŠ è¾¹,dfs1(rt,rt),dfs2(rt,rt),build(1,1,n),ä½¿ç”¨å°è£…å¥½çš„å‡½æ•°ä¿®æ”¹+æŸ¥è¯¢
namespace hld{//heavy-light decomposition
	int father[maxn],son[maxn],depth[maxn],siz[maxn];//çˆ¶èŠ‚ç‚¹,é‡å„¿å­èŠ‚ç‚¹,æ·±åº¦,å­æ ‘å¤§å°
	int tim=0,dfn[maxn],rk[maxn],top[maxn];//è®¡æ•°å™¨,æ—¶é—´æˆ³(èŠ‚ç‚¹ç¼–å·),è®¿é—®é¡ºåº,èŠ‚ç‚¹æ‰€åœ¨é‡é“¾çš„é¡¶éƒ¨èŠ‚ç‚¹
	ll w[maxn];//èŠ‚ç‚¹dfsåºå¯¹åº”æƒå€¼
	void init()
	{
		tim=tot=0;
		memset(head,-1,sizeof(head));
		memset(depth,0,sizeof(depth));
//		memset(father,0,sizeof(father));
		memset(son,0,sizeof(son));
//		memset(top,0,sizeof(top));
//		memset(dfn,0,sizeof(dfn));
	}
	void dfs1(int x,int fa)
	{//é¢„å¤„ç†å‡ºæ·±åº¦,çˆ¶èŠ‚ç‚¹,é‡å„¿å­,å­æ ‘å¤§å°
		depth[x]=depth[fa]+1;
		father[x]=fa;
		siz[x]=1;
		int maxsiz=-1;
		for(int i=head[x];~i;i=e[i].nex)
		{//éå†å„¿å­èŠ‚ç‚¹
			int v=e[i].v;
			if(v==fa)
				continue;
//			val[v]=e[i].w;//ä»¥ç‚¹ä»£è¾¹:å°†è¾¹çš„æƒå€¼èµ‹ç»™è¾¹å¤´èŠ‚ç‚¹
			dfs1(v,x);
			siz[x]+=siz[v];//åŠ ä¸Šå„¿å­çš„å­æ ‘å¤§å°
			if(maxsiz<siz[v])
			{
				son[x]=v;
				maxsiz=siz[v];//è®°å½•é‡å„¿å­
			}
		}
	}
	void dfs2(int x,int t)
	{//æŒ‰dfsåºå¯¹å„èŠ‚ç‚¹é‡æ–°ç¼–å·,å¹¶è®°å½•å¯¹åº”æƒå€¼åˆ°wæ•°ç»„
		dfn[x]=++tim;//è®°å½•dfsåº
		rk[tim]=x;//è®°å½•è®¿é—®èŠ‚ç‚¹çš„é¡ºåº,å³dfnçš„åå‡½æ•°
		top[x]=t;//æ³¨æ„è¿™é‡Œ,topæ˜¯åœ¨æ ‘å¤–çš„
		w[tim]=val[x];//å°†xç»“ç‚¹æƒå€¼å­˜åˆ°å¯¹åº”çš„æ—¶é—´æˆ³
		if(!son[x])//æ²¡æœ‰å„¿å­
			return;
		dfs2(son[x],t);//ç»§ç»­å¤„ç†é‡å„¿å­
		for(int i=head[x];~i;i=e[i].nex)//å¤„ç†å…¶ä»–å„¿å­
			if(e[i].v!=father[x]&&e[i].v!=son[x])
				dfs2(e[i].v,e[i].v);//å¼€å§‹å¦ä¸€æ¡é‡é“¾
	}
	int lca(int x,int y)
	{
		while(top[x]!=top[y])
		{
			if(depth[top[x]]<depth[top[y]])
				swap(x,y);
			x=father[top[x]];
		}
		return (depth[x]>depth[y])?y:x;
	}
	struct node//çº¿æ®µæ ‘æŒ‰dfsåºç»´æŠ¤æ ‘ä¸Šè·¯å¾„æƒå€¼éƒ¨åˆ†
	{
		ll val,Max,lazy;
	} tree[maxn<<2];
	inline void pushup(int root)
	{
		tree[root].val=tree[root<<1].val+tree[root<<1|1].val;
		tree[root].Max=max(tree[root<<1].Max,tree[root<<1|1].Max);
	}
	void build(int root,int l,int r)
	{
		tree[root].lazy=0;
		if(l==r)//æ³¨æ„è¿™é‡Œæ˜¯l
			tree[root].val=tree[root].Max=w[l];//æŒ‰æ—¶é—´æˆ³é¡ºåºçš„æ•°ç»„
		else{
			int mid=(l+r)>>1;
			build(root<<1,l,mid);
			build(root<<1|1,mid+1,r);
			pushup(root);
		}
	}
	inline void pushdown(int root,int l,int r)
	{
		if(tree[root].lazy)
		{
			int mid=(l+r)>>1;
			tree[root<<1].val=tree[root<<1].val+tree[root].lazy*(mid-l+1);
			tree[root<<1|1].val=tree[root<<1|1].val+tree[root].lazy*(r-mid);
			tree[root<<1].Max+=tree[root].lazy;//å­èŠ‚ç‚¹æœ€å¤§å€¼ä¹Ÿè¦+æ›´æ–°å€¼
			tree[root<<1|1].Max+=tree[root].lazy;
			tree[root<<1].lazy+=tree[root].lazy;
			tree[root<<1|1].lazy+=tree[root].lazy;
			tree[root].lazy=0;
		}
	}
	void modify(int root,int nst,int ned,int ust,int ued,ll num)
	{//åŒºé—´æ›´æ–°
		if(ned<ust||ued<nst)
			return;
		if(ust<=nst&&ued>=ned)
		{
			tree[root].val=tree[root].val+(ned-nst+1)*num;
			tree[root].Max+=num;
			tree[root].lazy+=num;
			return;
		}
		pushdown(root,nst,ned);
		int mid=(nst+ned)>>1;
		modify(root<<1,nst,mid,ust,ued,num);
		modify(root<<1|1,mid+1,ned,ust,ued,num);
		pushup(root);
	}
	ll query(int root,int nst,int ned,int qst,int qed)
	{//æŸ¥è¯¢åŒºé—´å’Œ
		if(ned<qst||qed<nst)
			return 0;
		if(qst<=nst&&ned<=qed)
			return tree[root].val;
		pushdown(root,nst,ned);
		int mid=(nst+ned)>>1;
		return query(root<<1,nst,mid,qst,qed)+query(root<<1|1,mid+1,ned,qst,qed);
	}
	ll qmax(int root,int nst,int ned,int qst,int qed)
	{//æŸ¥è¯¢åŒºé—´å’Œ
		if(ned<qst||qed<nst)
			return LLONG_MIN;
		if(qst<=nst&&ned<=qed)
			return tree[root].Max;
		pushdown(root,nst,ned);
		int mid=(nst+ned)>>1;
		return max(qmax(root<<1,nst,mid,qst,qed),qmax(root<<1|1,mid+1,ned,qst,qed));
	}
	inline void mson(int x,int n,ll addnum)
	{//å°†ä»¥xä¸ºæ ¹çš„å­æ ‘å…¨éƒ¨åŠ ä¸Šä¸€ä¸ªæ•°
		modify(1,1,n,dfn[x],dfn[x]+siz[x]-1,addnum);//å­æ ‘èŠ‚ç‚¹ç¼–å·æ˜¯è¿ç»­çš„
	}
	inline ll sonsum(int x,int n)
	{//æŸ¥è¯¢ä»¥xä¸ºæ ¹å­æ ‘æƒå€¼å’Œ
		return query(1,1,n,dfn[x],dfn[x]+siz[x]-1);//åŒä¸Š
	}
	ll sonmax(int x,int n)
	{
		return qmax(1,1,n,dfn[x],dfn[x]+siz[x]-1);
	}
	void mchain(int x,int y,int n,ll addnum)
	{
		while(top[x]!=top[y])//ä¸åœ¨åŒä¸€æ¡é“¾ä¸Šæ—¶
		{
			if(depth[top[x]]<depth[top[y]])
				swap(x,y);//ä¿è¯xæ‰€åœ¨é“¾é¡¶éƒ¨æ›´ä½
			modify(1,1,n,dfn[top[x]],dfn[x],addnum);//æ›´æ–°é¡¶éƒ¨èŠ‚ç‚¹è¾ƒä½çš„é‡é“¾(é¡¶éƒ¨èŠ‚ç‚¹åˆ°å½“å‰ç‚¹éƒ¨åˆ†)
			x=father[top[x]];//è·³åˆ°é“¾é¡¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹
		}
		if(depth[x]>depth[y])//ç›´åˆ°æœ€ååœ¨åŒä¸€æ¡é‡é“¾ä¸Š
			swap(x,y);//æ­¤æ—¶ä¿è¯xèŠ‚ç‚¹åœ¨yä¸Šé¢
		modify(1,1,n,dfn[x],dfn[y],addnum);
	}
	ll chainsum(int x,int y,int n)
	{
		ll ret=0;
		while(top[x]!=top[y])
		{
			if(depth[top[x]]<depth[top[y]])
				swap(x,y);
			ret+=query(1,1,n,dfn[top[x]],dfn[x]);
			x=father[top[x]];
		}
		if(depth[x]>depth[y])
			swap(x,y);
		return ret+query(1,1,n,dfn[x],dfn[y]);
	}
	ll chainmax(int x,int y,int n)
	{
		ll ret=LLONG_MIN;
		while(top[x]!=top[y])
		{
			if(depth[top[x]]<depth[top[y]])
				swap(x,y);
			ret=max(ret,qmax(1,1,n,dfn[top[x]],dfn[x]));
			x=father[top[x]];
		}
		if(depth[x]>depth[y])
			swap(x,y);
		return max(ret,qmax(1,1,n,dfn[x],dfn[y]));
	}
}
```



### 2ã€[P3384 æ ‘é“¾å‰–åˆ† ](https://www.luogu.org/problem/P3384)

```cpp
#include<bits/stdc++.h>
using namespace std;
typedef long long ll;
const int inf=0x3f3f3f3f;
const int maxn=100005;
int mod=100000007;
int head[maxn],cnt=0;
struct edge
{
	int v,nex;
} e[maxn<<1];
int father[maxn],son[maxn];//çˆ¶èŠ‚ç‚¹,é‡å„¿å­èŠ‚ç‚¹
int depth[maxn],siz[maxn],top[maxn];//æ·±åº¦,å­æ ‘å¤§å°,èŠ‚ç‚¹æ‰€åœ¨é‡é“¾çš„é¡¶éƒ¨èŠ‚ç‚¹
int tim=0,dfn[maxn],rk[maxn],w[maxn];//è®¡æ•°å™¨,æ—¶é—´æˆ³(èŠ‚ç‚¹ç¼–å·),è®¿é—®é¡ºåº
int val[maxn];//ç»™å®šçš„æ¯ä¸ªèŠ‚ç‚¹çš„æƒå€¼
void add(int u,int v)
{
	e[++cnt].v=v;
	e[cnt].nex=head[u];
	head[u]=cnt;
}
void dfs1(int x,int fa)
{
	father[x]=fa;
	depth[x]=depth[fa]+1;
	siz[x]=1;
	int maxsize=-1;
	for(int i=head[x];~i;i=e[i].nex)//éå†å„¿å­èŠ‚ç‚¹
	{
		int v=e[i].v;
		if(v==fa)
			continue;
		dfs1(v,x);
		siz[x]+=siz[v];//åŠ ä¸Šå„¿å­çš„å­æ ‘å¤§å°
		if(siz[v]>maxsize)
		{
			maxsize=siz[v];
			son[x]=v;//è®°å½•é‡å„¿å­
		}
	}
}
void dfs2(int x,int t)//å½“å‰èŠ‚ç‚¹ä¸é‡é“¾é¡¶èŠ‚ç‚¹
{
	top[x]=t;//è®°å½•è¯¥èŠ‚ç‚¹æ‰€åœ¨é‡é“¾çš„é¡¶éƒ¨èŠ‚ç‚¹
	dfn[x]=++tim;//è®°å½•è¯¥èŠ‚ç‚¹çš„è®¿é—®æ—¶é—´(ç»™èŠ‚ç‚¹ç¼–å·,æ–¹ä¾¿çº¿æ®µæ ‘æ“ä½œ)
	rk[tim]=x;//è®°å½•è®¿é—®èŠ‚ç‚¹çš„é¡ºåº
	w[tim]=val[x];//å°†xç»“ç‚¹æƒå€¼å­˜åˆ°å¯¹åº”çš„æ—¶é—´æˆ³
	if(!son[x])
		return;//æ²¡æœ‰å„¿å­
	dfs2(son[x],t);//ç»§ç»­å¤„ç†é‡å„¿å­
	for(int i=head[x];~i;i=e[i].nex)
	{//å¤„ç†å…¶ä»–å„¿å­
		if(e[i].v!=son[x]&&e[i].v!=father[x])
			dfs2(e[i].v,e[i].v);//å¼€å§‹å¦ä¸€æ¡é‡é“¾
	}
}
struct node
{
	int val,lazy;
} tree[maxn<<2];
inline void pushup(int root)
{
	tree[root].val=(tree[root<<1].val+tree[root<<1|1].val)%mod;
}
void build(int root,int l,int r)
{
	tree[root].val=tree[root].lazy=0;
	if(l==r)//æ³¨æ„è¿™é‡Œæ˜¯l
		tree[root].val=w[l]%mod;//æŒ‰æ—¶é—´æˆ³é¡ºåºçš„æ•°ç»„
	else{
		int mid=(l+r)>>1;
		build(root<<1,l,mid);
		build(root<<1|1,mid+1,r);
		pushup(root);
	}
}
inline void pushdown(int root,int l,int r)
{
	if(tree[root].lazy)
	{
		int mid=(l+r)>>1;
		tree[root<<1].val=(tree[root<<1].val%mod+(tree[root].lazy%mod*(mid-l+1))%mod)%mod;
		tree[root<<1|1].val=(tree[root<<1|1].val%mod+(tree[root].lazy%mod*(r-mid)%mod))%mod;
		tree[root<<1].lazy=(tree[root<<1].lazy%mod+tree[root].lazy%mod)%mod;
		tree[root<<1|1].lazy=(tree[root<<1|1].lazy%mod+tree[root].lazy%mod)%mod;
		tree[root].lazy=0;
	}
}
void modify(int root,int nst,int ned,int ust,int ued,int num)
{
	if(ned<ust||ued<nst)
		return;
	if(ust<=nst&&ued>=ned)
	{
		tree[root].lazy=(tree[root].lazy%mod+num%mod)%mod;
		tree[root].val=(tree[root].val%mod+((ned-nst+1)%mod*(num%mod))%mod)%mod;
		return;
	}
	pushdown(root,nst,ned);
	int mid=(nst+ned)>>1;
	modify(root<<1,nst,mid,ust,ued,num);
	modify(root<<1|1,mid+1,ned,ust,ued,num);
	pushup(root);
}
int query(int root,int nst,int ned,int qst,int qed)
{
	if(ned<qst||qed<nst)
		return 0;
	if(qst<=nst&&qed>=ned)
	{
		return tree[root].val%mod;
	}
	pushdown(root,nst,ned);
	int mid=(nst+ned)>>1;
	return (query(root<<1,nst,mid,qst,qed)+query(root<<1|1,mid+1,ned,qst,qed))%mod;
}
inline void mson(int x,int n,int addnum)
{//å°†ä»¥xä¸ºæ ¹çš„å­æ ‘å…¨éƒ¨åŠ ä¸Šä¸€ä¸ªæ•°
	modify(1,1,n,dfn[x],dfn[x]+siz[x]-1,addnum);//å­æ ‘èŠ‚ç‚¹ç¼–å·æ˜¯è¿ç»­çš„
}
inline int qson(int x,int n)
{
	return query(1,1,n,dfn[x],dfn[x]+siz[x]-1)%mod;//åŒä¸Š
}
void mchain(int x,int y,int n,int addnum)
{
	addnum%=mod;
	while(top[x]!=top[y])//ä¸åœ¨åŒä¸€æ¡é“¾ä¸Šæ—¶
	{
		if(depth[top[x]]<depth[top[y]])
			swap(x,y);//ä¿è¯xæ‰€åœ¨é“¾é¡¶éƒ¨æ›´ä½
		modify(1,1,n,dfn[top[x]],dfn[x],addnum);//æ›´æ–°é¡¶éƒ¨èŠ‚ç‚¹è¾ƒä½çš„é‡é“¾(é¡¶éƒ¨èŠ‚ç‚¹åˆ°å½“å‰ç‚¹éƒ¨åˆ†)
		x=father[top[x]];//è·³åˆ°é“¾é¡¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹
	}
	if(depth[x]>depth[y])//ç›´åˆ°æœ€ååœ¨åŒä¸€æ¡é‡é“¾ä¸Š
		swap(x,y);//æ­¤æ—¶ä¿è¯xèŠ‚ç‚¹åœ¨yä¸Šé¢
	modify(1,1,n,dfn[x],dfn[y],addnum);
}
int qchain(int x,int y,int n)
{
	int ret=0;
	while(top[x]!=top[y])
	{
		if(depth[top[x]]<depth[top[y]])
			swap(x,y);
		ret=(ret+query(1,1,n,dfn[top[x]],dfn[x]))%mod;
		x=father[top[x]];
	}
	if(depth[x]>depth[y])
		swap(x,y);
	return (ret+query(1,1,n,dfn[x],dfn[y]))%mod;
}
int main()
{
//	freopen("P3384.in","r",stdin);
	int n,m,p,r;
	scanf("%d%d%d%d",&n,&m,&r,&mod);
	memset(head,-1,sizeof(head));
	for(int i=1;i<=n;i++)
		scanf("%d",&val[i]);
	for(int i=1;i<n;i++)
	{
		int u,v;
		scanf("%d%d",&u,&v);
		add(u,v);
		add(v,u);
	}
	dfs1(r,r);
	dfs2(r,r);
	build(1,1,n);
	while(m--)
	{
		int ope,x,y,z;
		scanf("%d",&ope);
		if(ope==1)
		{//é“¾x->yä¿®æ”¹,å…¨éƒ¨åŠ ä¸Šz
			scanf("%d%d%d",&x,&y,&z);
			mchain(x,y,n,z);
		}
		else if(ope==2)
		{//é“¾x->yæŸ¥è¯¢
			scanf("%d%d",&x,&y);
			printf("%d\n",qchain(x,y,n));
		}
		else if(ope==3)
		{//xå­æ ‘ä¿®æ”¹
			scanf("%d%d",&x,&z);
			mson(x,n,z);
		}
		else{//xå­æ ‘æŸ¥è¯¢
			scanf("%d",&x);
			printf("%d\n",qson(x,n));
		}
	}
//	for(int i=1;i<=n;i++)
//		printf("%d:%d\n",i,tree[i].val);
	return 0;
}
/*
 *åŠŸèƒ½ï¼š
 *1.æ›´æ–°/æŸ¥è¯¢æŸä¸ªèŠ‚ç‚¹å­æ ‘çš„æƒå€¼
 *2.æ›´æ–°/æŸ¥è¯¢æ ‘ä¸Šä¸¤ä¸ªèŠ‚ç‚¹é—´æ‰€æœ‰ç‚¹çš„æƒå€¼
 *æ€§è´¨ï¼š
 *1.å­æ ‘çš„æ—¶é—´æˆ³ä¸€å®šå…¨éƒ¨å°äºçˆ¶èŠ‚ç‚¹ï¼Œå¹¶ä¸”è¿ç»­
 *2.ä»»ä½•ä¸€æ¡è·¯å¾„éƒ½æ˜¯ç”±é‡é“¾çš„ä¸€éƒ¨åˆ†ä¸é‡é“¾é—´çš„å¶å­èŠ‚ç‚¹æ„æˆ
 *3.ä»»ä½•çˆ¶èŠ‚ç‚¹éƒ½ä¸€å®šåœ¨ä¸€æ¡é‡é“¾ä¸Š
*/
```

## å››ã€ç‚¹åˆ†æ²»

### 1ã€æ ‘çš„é‡å¿ƒ

- ä¹Ÿå«æ ‘çš„è´¨å¿ƒã€‚æ‰¾åˆ°ä¸€ä¸ªç‚¹,å…¶æ‰€æœ‰çš„å­æ ‘ä¸­æœ€å¤§çš„å­æ ‘èŠ‚ç‚¹æ•°æœ€å°‘,é‚£ä¹ˆè¿™ä¸ªç‚¹å°±æ˜¯è¿™æ£µæ ‘çš„é‡å¿ƒ,åˆ å»é‡å¿ƒåï¼Œç”Ÿæˆçš„å¤šæ£µæ ‘å°½å¯èƒ½å¹³è¡¡ã€‚

### 2ã€æµç¨‹

1. æ‰¾å‡ºå½“å‰æ ‘çš„é‡å¿ƒ
   - å› ä¸ºåˆ†æ²»æ­¥éª¤äºŒéœ€è¦å°†sumèµ‹å€¼ä¸ºå½“å‰æ ‘å¤§å°(siz[v])ï¼Œæ‰€ä»¥getrtè¦è·‘ä¸¤é
2. å¤„ç†ç»è¿‡ä¸­å¿ƒçš„è·¯å¾„
   - ç‚¹åˆ†æ²»è¿ç®—çš„æ ¸å¿ƒï¼Œç»å¸¸ä¼šå‡ºç°å˜å½¢
3. åˆ é™¤æ ‘çš„é‡å¿ƒ
4. å¯¹æ–°å¾—åˆ°çš„å­æ ‘é‡å¤ä¸Šè¿°æ­¥éª¤

### 3ã€ä¾‹é¢˜

ä¸€æ£µnèŠ‚ç‚¹çš„æ ‘ï¼Œè¯¢é—®æ ‘ä¸Šè·ç¦»ä¸ºkçš„ç‚¹å¯¹æ˜¯å¦å­˜åœ¨ã€‚ç¦»çº¿æ“ä½œã€‚

```cpp
#include<bits/stdc++.h>
using namespace std;
typedef long long ll;
const int maxn=10005;
const int maxk=10000005;
int tot=0,head[maxn];
struct edge
{
	int v,nex,w;
} e[maxn<<1];
inline void add(int u,int v,ll w)
{
	e[++tot].v=v;
	e[tot].nex=head[u];
	e[tot].w=w;
	head[u]=tot;
}
int n,m,root,sum=0;//é‡å¿ƒ,sumå½“å‰å¤§å°
int siz[maxn],maxp[maxn];
bool vis[maxn];
void getrt(int x,int fa)
{//DFSæ‰¾é‡å¿ƒ
	siz[x]=1,maxp[x]=0;//maxpä¸ºæœ€å¤§å­æ ‘å¤§å°
	for(int i=head[x];~i;i=e[i].nex)
	{
		int v=e[i].v;
		if(v==fa||vis[v])
			continue;
		getrt(v,x);
		siz[x]+=siz[v];
		if(siz[v]>maxp[x])
			maxp[x]=siz[v];//è®°å½•ä¸‹é¢çš„æœ€å¤§å­æ ‘å¤§å°
	}//æ— æ ¹æ ‘,sum-siz[x]ä¸ºä»¥xçš„çˆ¶èŠ‚ç‚¹ä¸ºæ ¹çš„å¤§å°
	//åœ¨ä»¥è‡ªèº«ä¸ºæ ¹èŠ‚ç‚¹çš„å­æ ‘å¤§å°å’Œä»¥xçš„çˆ¶èŠ‚ç‚¹ä¸ºæ ¹çš„å¤§å°ä¸­å–è¾ƒå¤§çš„
	maxp[x]=max(maxp[x],sum-siz[x]);//sumä¸ºæ•´æ£µæ ‘çš„å¤§å°
	if(maxp[x]<maxp[root])
		root=x;//æœ€å¤§å­æ ‘æœ€å°çš„ç‚¹ä¸ºé‡å¿ƒ
}
int dist[maxn],tmp[maxn],cnt=0;//cntè®¡æ•°å™¨
void getdist(int x,int fa)
{//DFSæ±‚å„ç‚¹åˆ°rootçš„è·ç¦»,è®°å½•åœ¨tmpä¸­
	tmp[++cnt]=dist[x];
	for(int i=head[x];~i;i=e[i].nex)
	{
		int v=e[i].v;
		if(v==fa||vis[v])
			continue;
		dist[v]=dist[x]+e[i].w;
		getdist(v,x);
	}
}
int q[105];//qè®°å½•è¯¢é—®è·ç¦»
bool jud[maxk],ans[105];//å­˜æ”¾ä¹‹å‰å­æ ‘ä¸­çš„å­˜åœ¨è·¯å¾„é•¿åº¦,ansåˆ¤æ–­kæ˜¯å¦å­˜åœ¨
queue<int> QwQ;
void solve(int x)
{//å¤„ç†ç»è¿‡æ ¹èŠ‚ç‚¹xçš„è·¯å¾„
	for(int i=head[x];~i;i=e[i].nex)
	{
		int v=e[i].v;
		if(vis[v])//è¯¥ç‚¹å·²ç»è¢«å»æ‰
			continue;
		cnt=0;
		dist[v]=e[i].w;//è®¾ç½®rootä¸å„¿å­çš„è·ç¦»
		getdist(v,x);
		for(int j=1;j<=cnt;j++)//éå†è¯¥å­æ ‘ä¸Šçš„è·ç¦»
			for(int k=1;k<=m;k++)//éå†è¯¢é—®
				if(q[k]>=tmp[j])//æœ‰æ‹¼å‡ºæ¥çš„å¯èƒ½æ€§
					ans[k]|=jud[q[k]-tmp[j]];//å¯ä»¥ç”¨ä¹‹å‰ä»¥xä¸ºé¡¶çš„è·ç¦»æ‹¼èµ·æ¥
		for(int j=1;j<=cnt;j++)//å°†è¿™æ£µå­æ ‘çš„è·ç¦»å­˜èµ·æ¥
		{//ä¾›ä¹‹åçš„ä»¥xä¸ºèŠ‚ç‚¹çš„å­æ ‘æ‹¼è·¯å¾„ä½¿ç”¨
			QwQ.push(tmp[j]);
			jud[tmp[j]]=1;
		}
	}
	while(!QwQ.empty())
	{
		jud[QwQ.front()]=0;
		QwQ.pop();
	}
}
void divide(int x)
{
	vis[x]=jud[0]=1;//å»æ‰æ ¹èŠ‚ç‚¹x
	solve(x);//å¤„ç†æ‰€æœ‰ç»è¿‡xçš„è·¯å¾„
	for(int i=head[x];~i;i=e[i].nex)
	{
		int v=e[i].v;
		if(vis[v])
			continue;
		maxp[root=0]=sum=siz[v];//é‡å¿ƒç½®ä¸º0,maxp[0]ç½®ä¸ºæœ€å¤§å€¼(æ‰€ä»¥è¦é‡æ–°DFSè®¡ç®—siz)
		getrt(v,0);//åœ¨ä»¥vä¸ºæ ¹çš„å­æ ‘ä¸Šæ‰¾é‡å¿ƒ
		getrt(root,0);//å¤„ç†å‡ºä»¥vä¸ºæ ¹çš„sizæ•°ç»„
		divide(root);
	}
}
int main()
{
	int k,u,v;
	ll w;
	memset(head,-1,sizeof(head));
	cin>>n>>m;
	for(int i=1;i<n;i++)
	{//ç‚¹uåˆ°ç‚¹vè·ç¦»ä¸ºw
		cin>>u>>v>>w;
		add(u,v,w);
		add(v,u,w);
	}
	for(int i=1;i<=m;i++)
		cin>>q[i];
	maxp[0]=sum=n;//ç½®ä¸ºæœ€å¤§å€¼
	getrt(1,0);
	getrt(root,0);//æ›´æ–°ä»¥é‡å¿ƒä¸ºæ ¹çš„sizæ•°ç»„
	divide(root);
	for(int i=1;i<=m;i++)
		cout<<(ans[i]?"AYE":"NAY")<<'\n';
	return 0;
}
```



#### æ›´å¤šé˜…è¯»
+ [ã€æ¯æ—¥ä¸€é¢˜ã€‘(34é¢˜)é¢è¯•å®˜:ä½ å¯¹å›¾è®ºäº†è§£å¤šå°‘ï¼Ÿ(å››)](https://mp.weixin.qq.com/s/EJ_72u5S7KD4950IEO_CQg)

+ [ã€æ¯æ—¥ä¸€é¢˜ã€‘(33é¢˜)é¢è¯•å®˜:ä½ å¯¹å›¾è®ºäº†è§£å¤šå°‘ï¼Ÿ(ä¸‰)](https://mp.weixin.qq.com/s/wRy1xAm4JzHCq1dRjMUuoA)

+ [ã€æ¯æ—¥ä¸€é¢˜ã€‘(32é¢˜)é¢è¯•å®˜:ä½ å¯¹å›¾è®ºäº†è§£å¤šå°‘ï¼Ÿ(äºŒ)](https://mp.weixin.qq.com/s/_aSMIEpBc2jvTFXxBaK7nQ)

+ [[ã€æ¯æ—¥ä¸€é¢˜ã€‘(31é¢˜)é¢è¯•å®˜:ä½ å¯¹å›¾è®ºäº†è§£å¤šå°‘ï¼Ÿ(ä¸€)](https://mp.weixin.qq.com/s/E6dh8A9dVxxB9jaRGm3kbg)


## è°¢è°¢æ”¯æŒ

1ã€ä½œè€…æ˜µç§°ï¼šsaucxsï¼ŒsongEagleï¼Œæ¾å®å†™ä»£ç ã€‚ã€Œæ¾å®å†™ä»£ç ã€å…¬ä¼—å·ä½œè€…ï¼Œæ¯æ—¥ä¸€é¢˜ï¼Œå®éªŒå®¤ç­‰ã€‚ä¸€ä¸ªçˆ±å¥½æŠ˜è…¾ï¼Œè‡´åŠ›äºå…¨æ ˆï¼Œæ­£åœ¨åŠªåŠ›æˆé•¿çš„å­—èŠ‚è·³åŠ¨å·¥ç¨‹å¸ˆï¼Œæ˜Ÿè¾°å¤§æµ·ï¼Œæœªæ¥å¯æœŸã€‚**å†…æ¨å­—èŠ‚è·³åŠ¨å„ä¸ªéƒ¨é—¨å„ä¸ªå²—ä½ã€‚**

2ã€é•¿æŒ‰ä¸‹é¢å›¾ç‰‡ï¼Œå…³æ³¨ã€Œæ¾å®å†™ä»£ç ã€ï¼Œæ˜¯è·å–å¼€å‘çŸ¥è¯†ä½“ç³»æ„å»ºï¼Œç²¾é€‰æ–‡ç« ï¼Œé¡¹ç›®å®æˆ˜ï¼Œå®éªŒå®¤ï¼Œ**æ¯æ—¥ä¸€é“é¢è¯•é¢˜**ï¼Œè¿›é˜¶å­¦ä¹ ï¼Œæ€è€ƒèŒä¸šå‘å±•ï¼Œæ¶‰åŠåˆ°JavaScriptï¼ŒNodeï¼ŒVueï¼ŒReactï¼Œæµè§ˆå™¨ï¼Œhttpï¼Œç®—æ³•ï¼Œç«¯ç›¸å…³ï¼Œå°ç¨‹åºç­‰é¢†åŸŸï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©åˆ°ä½ ï¼Œæˆ‘ä»¬ä¸€èµ·æˆé•¿ï½

![æ¾å®å†™ä»£ç ](https://raw.githubusercontent.com/saucxs/full_stack_knowledge_list/master/daily-question/dongtai.gif?raw=true)

3ã€æ–‡ç« å–œæ¬¢çš„è¯**å¯ä»¥ã€Œåˆ†äº«ï¼Œç‚¹èµï¼Œåœ¨çœ‹ã€ä¸‰è¿**å“¦ã€‚

4ã€**çº¢åŒ…ğŸ§§ç¦åˆ©**

å„ä½å¤§ä½¬ä»¬ï¼Œç”¨ç”µè„‘PCå’Œæ˜é‡‘Appï¼Œå¸®æˆ‘æ¯å¤©å¸®å¿™æ‰“å¡æŠ•ç¥¨é¢†çº¢åŒ…ï¼š

+ 1ã€PCï¼šhttps://rank.juejin.cn/?u=saucxs&t=userï¼Œæ¯å¤©æŠ•æˆ‘xç¥¨ï¼Œç„¶åæˆªå›¾ã€‚

+ 2ã€APPï¼šä¸‹è½½æ˜é‡‘APPï¼Œæ‰“å¼€åä»é¦–é¡µæ´»åŠ¨é¡µè¿›å…¥ï¼Œæœç´¢saucxsï¼ŒæŠ•æˆ‘xç¥¨ï¼Œç„¶åæˆªå›¾ã€‚

+ 3ã€åœ¨ã€Œæ¾å®å†™ä»£ç ã€åå°å›å¤æˆ‘æˆªå›¾ï¼Œç„¶åæˆ‘ä»¬æŠ½å¥–å‘çº¢åŒ…ï¼Œä»1.27å¼€å§‹æ¯å¤©éƒ½æŠ•é€’çš„ï¼Œæœ‰æ›´å¤šæƒŠå–œã€‚
